<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Midgarverse | Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="importmap">
        {
          "imports": {
            "three": "https://unpkg.com/three/build/three.module.js",
            "GLTFLoader":"https://unpkg.com/three/examples/jsm/loaders/GLTFLoader.js",
            "OutlineEffect":"https://unpkg.com/three/examples/jsm/effects/OutlineEffect.js"
          }
        }
    </script>
    <script type="module">
        import * as THREE from "three";
        import { GLTFLoader } from "GLTFLoader";
        import { OutlineEffect } from "OutlineEffect";
        const scene = new THREE.Scene();

        const cam2Group = new THREE.Group();
        const cameraGroup = new THREE.Group()
        cam2Group.add(cameraGroup);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        cameraGroup.add(camera);
        scene.add(cam2Group);

        const ball = new THREE.Mesh(new THREE.SphereGeometry(0.0625, 32, 16), new THREE.MeshBasicMaterial({ color: 0xff0000 }));
        // scene.add(ball);

        const canvas = document.querySelector('canvas.webgl');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;

        let lastKnownScr = 0;
        let ticking = false;
        let particles;

        const plight = new THREE.PointLight(0xfffcfa, 0.8, 50, 0.05);
        plight.castShadow = true;
        plight.shadow.mapSize.width = 2048;
        plight.shadow.mapSize.height = 2048;
        plight.shadow.camera.near = 0.1;
        plight.shadow.camera.far = 30;
        plight.shadow.focus = 1
        plight.shadow.bias = -0.002;
        plight.position.set(0, 4, 0);
        scene.add(plight);

        const particleNum = 30000;
        const maxRange = 20;
        const minRange = 10;

        const onResize = () => {
            const width = window.innerWidth;
            const height = window.innerHeight;
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(width, height);
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
        }

        let points = [];

        for (let i = 0; i < particleNum; i++) {
            const x = (0.5 - Math.random()) * maxRange;
            const y = (0.5 - Math.random()) * maxRange;
            const z = (0.5 - Math.random()) * maxRange;
            const particle = new THREE.Vector3(x, y, z);
            points.push(particle);
        }
        let pointGeometry = new THREE.BufferGeometry().setFromPoints(points);

        let tLoader = new THREE.TextureLoader();
        tLoader.load('./images/snow.png', function (texture) {
            const pointMaterial = new THREE.PointsMaterial({
                size: 0.03,
                vertexColors: false,
                map: texture,
                transparent: true,
                fog: true,
                depthWrite: false
            });

            particles = new THREE.Points(pointGeometry, pointMaterial);
            particles.geometry.velocities = velocities;

            scene.add(particles);
        });

        const velocities = [];
        for (let i = 0; i < particleNum; i++) {
            const x = (Math.random() * 6 - 3) * 0.1;
            const y = (Math.random() * 10 + 3) * - 0.05;
            const z = (Math.random() * 6 - 3) * 0.1;
            const particle = new THREE.Vector3(x, y, z);
            velocities.push(particle);
        }

        const colors = new Uint8Array(10);

        const format = (renderer.capabilities.isWebGL2) ? THREE.RedFormat : THREE.LuminanceFormat;
        for (let c = 0; c <= colors.length; c++) {
            colors[c] = (c / colors.length) * 256;
        }
        const gradientMap = new THREE.DataTexture(colors, colors.length, 1, format);
        gradientMap.needsUpdate = true;

        const floorgeo = new THREE.CircleGeometry(200, 16);

        var texture = document.createElement('canvas');
        texture.width = texture.height = 500;
        var ctx = texture.getContext('2d');
        var x = 250,
            y = 250,
            innerRadius = 0,
            outerRadius = 200,
            radius = 200;
        var gradient = ctx.createRadialGradient(x, y, innerRadius, x, y, outerRadius);

        scene.background = new THREE.Color(0x0a0e14);
        scene.fog = new THREE.FogExp2(0x0a0e14, 0.035);
        gradient.addColorStop(0, 'rgb(200,200,200)');
        gradient.addColorStop(0.1, 'rgb(134,134,134)');

        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, 500, 1500);
        var texture = new THREE.Texture(texture);
        texture.needsUpdate = true;
        var cGradMaterial = new THREE.MeshStandardMaterial({
            map: texture,
            roughness: 1.0,
            metalness: 0.0,
        });


        const floor = new THREE.Mesh(floorgeo, cGradMaterial);
        floor.rotation.set(-0.5 * Math.PI, 0, 0)
        floor.position.set(0, 0, 0);
        floor.receiveShadow = true;
        scene.add(floor);

        const loader = new GLTFLoader();
        loader.load('models/combat.glb', function (gltf) {
            for (let i = 0; i < gltf.scene.children.length; i++) {
                const element = gltf.scene.children[i];
                element.castShadow = true;
                element.receiveShadow = true;
            }
            scene.add(gltf.scene);
            animate();
        });
        document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.documentElement.style.setProperty('--vh', `${window.innerHeight * 0.01}px`);
            render();
        }, false);

        const effect = new OutlineEffect(renderer, { "defaultThickness": 0.0005, "defaultColor": [0.25, 0.25, 0.25] });

        const camPositionsX = [0, 0, 0, -3.6, -3.6, -2.65, -2.65, -3.15, -3.15, 2, 2, 2.5, 2.5,];
        const camPositionsY = [1.4, 1.4, 1.4, 1.5, 1.5, 1.2, 1.2, 1.3, 1.3, 1.2, 1.2, 1.4, 1.4, 1.5, 1.5,];
        const camPositionsZ = [0, 0, 0, -3.6, -3.6, 2.6, 2.6, -1, -1, 1.9, 1.9, -2.5, -2.5,];

        const camRailX = [0, -3.6, -2.65, -3.15, 2, 2.5,];
        const camRailY = [1.4, 1.5, 1.2, 1.3, 1.2, 1.4, 1.5,];
        const camRailZ = [0, -3.6, 2.6, -1, 1.9, -2.5,];

        const cursor = {}
        cursor.x = 0
        cursor.y = 0

        var moveTO = 1;

        window.addEventListener('mousemove', (event) => {
            cursor.x = event.clientX / window.innerWidth - 0.5
            cursor.y = event.clientY / window.innerHeight - 0.5
            moveTO = 10;
        })

        function lerp(before, after, atPoint) {
            return before + (after - before) * atPoint;
        };

        window.onscroll = function () { scrollFunction() };

        function scrollFunction() {
            var logo = document.getElementById("logo");
            var l10 = 6000;
            var l9 = 5400;
            var l8 = 4800;
            var l7 = 4200;
            var l6 = 3600;
            var l5 = 2600;
            var l4 = 2200;
            var l3 = 1800;
            var l2 = 1000;
            var l1 = 500;

            if (window.pageYOffset > l9) {
                var interp = ((window.pageYOffset - l9) / (l10 - l9));
                logo.style.width = "20vw";
                logo.style.marginTop = "24px";
                logo.style.marginLeft = "2vw";
                plight.intensity = 0.85;

                cameraGroup.position.set(0, 0, 0)
            } else {
                if (window.pageYOffset > l8) {
                    var interp = ((window.pageYOffset - l8) / (l9 - l8));
                    logo.style.width = "20vw";
                    logo.style.marginTop = "24px";
                    logo.style.marginLeft = "2vw";
                    plight.intensity = 0.85;

                    cameraGroup.position.set(0, 0, 0)
                } else {
                    if (window.pageYOffset > l7) {
                        var interp = ((window.pageYOffset - l7) / (l8 - l7));
                        logo.style.width = "20vw";
                        logo.style.marginTop = "24px";
                        logo.style.marginLeft = "2vw";
                        plight.intensity = 0.85;

                        cameraGroup.position.set(0, 0, 0)
                    } else {
                        if (window.pageYOffset > l6) {
                            var interp = ((window.pageYOffset - l6) / (l7 - l6));
                            logo.style.width = "20vw";
                            logo.style.marginTop = "24px";
                            logo.style.marginLeft = "2vw";
                            plight.intensity = 0.85;

                            cameraGroup.position.set(0, 0, 0)
                        } else {
                            if (window.pageYOffset > l5) {
                                var interp = ((window.pageYOffset - l5) / (l6 - l5));
                                logo.style.width = "20vw";
                                logo.style.marginTop = "24px";
                                logo.style.marginLeft = "2vw";
                                plight.intensity = 0.85;

                                cameraGroup.position.set(0, 0, 0)
                            } else {
                                if (window.pageYOffset > l4) {
                                    var interp = ((window.pageYOffset - l4) / (l5 - l4));
                                    logo.style.width = "20vw";
                                    logo.style.marginTop = "24px";
                                    logo.style.marginLeft = "2vw";
                                    plight.intensity = 0.85;

                                    cameraGroup.position.set(0, 0, 0)
                                } else {
                                    if (window.pageYOffset > l3) {
                                        var interp = ((window.pageYOffset - l3) / (l4 - l3));
                                        logo.style.width = "20vw";
                                        logo.style.marginTop = "24px";
                                        logo.style.marginLeft = "2vw";
                                        plight.intensity = 0.85;

                                        cameraGroup.position.set(0, 0, 0)
                                    } else {
                                        if (window.pageYOffset > l2) {
                                            var interp = ((window.pageYOffset - l2) / (l3 - l2));
                                            logo.style.width = 40 - (20 * interp) + "vw";
                                            logo.style.marginTop = 54 - (30 * interp) + "px";
                                            logo.style.marginLeft = 12 - (10 * interp) + "vw";
                                            plight.intensity = 0.65 + 0.2 * interp;

                                            cameraGroup.position.set(0, 3 * (1 - interp), 0)
                                        } else {
                                            if (window.pageYOffset > l1) {
                                                var interp = ((window.pageYOffset - l1) / (l2 - l1));
                                                logo.style.width = 60 - (20 * interp) + "vw";
                                                logo.style.marginTop = 72 - (18 * interp) + "px";
                                                logo.style.marginLeft = 20 - (8 * interp) + "vw";
                                                plight.intensity = 0.5 + 0.15 * interp;

                                                cameraGroup.position.set(0, 3, 0)
                                            } else {
                                                logo.style.width = "60vw";
                                                logo.style.marginTop = "72px";
                                                logo.style.marginLeft = "20vw";
                                                plight.intensity = 0.5;

                                                cameraGroup.position.set(0, 3, 0)
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        const vertex = new THREE.Vector3();
        var offset = 0; var xO = 0; var yO = 0; var zO = 0;
        var tempOffset = 0; var xTO = 0; var yTO = 0; var zTO = 0;
        var oldTime = performance.now() * 0.001;
        var dir = 1;
        var interpIndex = 0;
        var steps = 360;

        function render() {
            var time = performance.now() * 0.001;
            var delta = time - oldTime;
            moveTO -= delta;
            oldTime = time;
            var docLen = document.height;
            steps--;

            if (steps < 1) {
                if (Math.random() > 0.995) {
                    var newIndex = interpIndex;
                    var iter = 0;
                    while (newIndex == interpIndex && iter < 5) {
                        newIndex = Math.floor(camRailX.length * Math.random());
                        iter++
                    }
                    xTO = -camRailX[newIndex] + camRailX[interpIndex];
                    yTO = -camRailY[newIndex] + camRailY[interpIndex];
                    zTO = -camRailZ[newIndex] + camRailZ[interpIndex];
                    interpIndex = newIndex;
                    tempOffset += (2 * Math.random() - 1) * 3.14159;
                    dir *= -1;
                    steps = 360;
                }
            }

            offset += 0.05 * tempOffset;
            tempOffset *= 0.95;
            xO += 0.025 * xTO;
            xTO *= 0.975;
            yO += 0.025 * yTO;
            yTO *= 0.975;
            zO += 0.025 * zTO;
            zTO *= 0.975;
            var posX = camRailX[interpIndex] + xTO;
            var posY = camRailY[interpIndex] + yTO;
            var posZ = camRailZ[interpIndex] + zTO;

            cam2Group.position.set(posX, posY, posZ)
            ball.position.set(posX, posY, posZ)

            var camGPosX = 3 - 6.2832 * cursor.x + time * (1/Math.max(1,moveTO)) * 0.1 + offset;
            var camGPosZ = 3 - 6.2832 * cursor.x + time * (1/Math.max(1,moveTO)) * 0.1 + offset;
            var camGPosY = -1.25 - 3 * cursor.y

            camera.position.set(dir * 3 * Math.cos(camGPosX), -camGPosY, 3 * Math.sin(camGPosX))
            camera.lookAt(posX, posY, posZ);

            effect.render(scene, camera);

            particles.geometry.verticesNeedUpdate = true;
        }

        function animate() {

            var time = performance.now() * 0.001; 
            if (null == particles) return;
            const posArr = particles.geometry.getAttribute('position');
            for (var i = 0; i < posArr.count; i++) {

                vertex.fromBufferAttribute(posArr, i);

                const x = i * 3;
                const y = i * 3 + 1;
                const z = i * 3 + 2;

                const velX = Math.sin(time * 0.001 * velocities[i].x) * 0.1;
                const velZ = Math.cos(time * 0.0015 * velocities[i].z) * 0.1;

                vertex.x += velX;
                vertex.y += velocities[i].y;
                vertex.z += velZ;

                if (vertex.y < -0.5 * minRange) {
                    vertex.y = minRange;
                }

            }
            requestAnimationFrame(animate);
            render();
        }

        scrollFunction();
        animate();

        // const parameters = {
        //     intensity: 0.25,
        //     light_posX: 0,
        //     light_posY: 4,
        //     light_posZ: 0,

        // };

        // function update() {

        //     // plight.Color = parameters.threshold;
        //     plight.posX = parameters.light_posX;
        //     plight.posY = parameters.light_posY;
        //     plight.posZ = parameters.light_posZ;

        // }

        // const gui = new GUI();
        // gui.add(parameters, 'intensity', 0, 1, 0.01).onChange(update);
        // gui.add(parameters, 'light_posX', -20, 20, 0.1).onChange(update);
        // gui.add(parameters, 'light_posY', 0, 20, 0.1).onChange(update);
        // gui.add(parameters, 'light_posZ', -20, 20, 0.1).onChange(update);


    </script>
    <style>
        @font-face {
            font-family: 'Inknut Antiqua';
            font-style: normal;
            font-weight: 600;
            src: local(''),
                url('./fonts/inknut-antiqua-v12-latin-600.woff2') format('woff2'),
                url('./fonts/inknut-antiqua-v12-latin-600.woff') format('woff');
        }

        html {
            scroll-behavior: smooth;
            min-height: 100%;
        }

        body {
            margin: 0px;
            min-height: 100vh;
            height: 6000px;
            position: relative;
        }

        .floating {
            background-color: rgba(0, 0, 0, 0);
            text-align: center;
            overflow-y: hidden;
        }

        h1 {
            font-family: 'Inknut Antiqua';
            font-size: 2.25vh;
            position: relative;
            color: #fff;
        }

        h2 {
            font-family: 'Inknut Antiqua';
            font-size: 2vh;
            position: relative;
            color: #fff;
        }

        p {
            position: relative;
            font-size: 1.75vh;
            line-height: 2vh;
            color: #fff;
        }

        .div-table {
            display: table;
            width: 85%;
            margin: 7.5%;
            overflow-y: hidden;
        }

        .div-table-row {
            display: table-row;
            clear: both;
            margin: 7.5%;
        }

        .div-table-col {
            float: left;
            display: table-column;
            color: #fff;
            min-width: 25vw;
        }
    </style>
</head>

<body>
    <canvas class="webgl" style="position:fixed; top:0vh; left:0vw;" zIndex="-1"></canvas>
    <img src="./images/logo.png" id="logo" style="position:fixed; overflow-y: hidden; margin-top:72px; margin-left:20vw; width:60vw;" zIndex="5555">
    <div class="div-table">
        <!-- <div class="topFixed" style="position:fixed; top:0vh; left:0vw; text-align: center; color: #fff;overflow-y: hidden;"
        zIndex="5555">
    </div> -->
        <div class="div-table-row" id="content" style="overflow-x:hidden; text-align:center;">
            <div style="margin-left:auto; margin-right:auto; margin-top:1600px; width:1080px; max-width:90vw;">
                <h2>Explore the wondrous and often unforgiving world of the Vikings</h2>
                <p>Set in the Iron Age, Midgarverse promises to deliver an immersive experience for players looking to
                    explore and fight their way to fame and glory.</p>
            </div>
            <div style="margin-left:auto; margin-right:auto; margin-top:800px; width:1080px; max-width:90vw;">
                <h2>Establish sprawling Trade Empires and unstoppable Military Alliances</h2>
                <p>Social contracts allow players to create binding oaths, enabling rich commerce and military
                    collaborative play.<br>
                    Via Trade Contracts, Vikings can control the supply and demand of commodities for kingdoms and
                    empires well beyond the borders of Viking Scandinavia.<br>
                    Owned land provides further opportunity to foster relationships and boost trade income and military
                    stability.</p>
            </div>
            <div style="margin-left:auto; margin-right:auto; margin-top:800px; width:1080px; max-width:90vw;">
                <h2>Brave the stormy and icy waves with the likes of Harald Bluetooth, Hrafna-Floki and Leif Erikson
                </h2>
                <p>Players must engage in the prominent Viking tradition of seafaring. Join the Clan Fleet, or command
                    your own vessel as you set forth to unchartered waters.<br>
                    Hostile raids, trade missions, and exploration journeys each offer unique ways of increasing a
                    Viking's fame and wealth</p>
            </div>
            <div style="margin-left:auto; margin-right:auto; margin-top:800px; width:1080px; max-width:90vw;">
                <h2>Secure your land, gather its resources, and fortify your position</h2>
                <p>Land ownership opens a whole world of opportunities. From logging and hunting, to farming, smithing
                    and shipbuilding, owning land gives Vikings the chance to generate natural and fabricated
                    resources.<br>
                    Moreover, each land has a number of construction slots which can be developed to suit the owner's
                    needs.<br>
                    Each type of construction has its own aesthetics and benefits to the landowner.<br>
                    Land can be gained as a conquest of enemy lands following raids and battles, as a discovery when
                    exploring new lands to settle, or as part of a trade arrangement with foreign kingdoms.<br>
                    Rental contracts allow Vikings to lease and rent land from other Vikings, increasing the
                    accessibility of rare materials and generating passive income for landowners.
                </p>
            </div>
            <div
                style="margin-left:auto; margin-right:auto; margin-top:800px; margin-bottom:800px; width:1080px; max-width:90vw;">
                <h2>Topple Kingdoms and Empires and trample their armies under Odin's banner</h2>
                <p>It is a time of change and conflict for the Vikings. <br>
                    The expansion of the Holy Roman Empire and other Christian kingdoms threatens our ways. <br>
                    The Volvas have seen the death of our gods. <br>
                    The time of swords and axes, the wolf blizzard and ragnarok are comming.<br>
                    We must fight and die with glory. That is the Viking way.
                </p>
            </div>
        </div>
    </div>
</body>

</html>